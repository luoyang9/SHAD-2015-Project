<!DOCTYPE html>
<html lang="en">
<head>
	<title>Profiles - SHAD Project</title>
	<link rel="shortcut icon" href="../img/logo.ico">

	<link rel="stylesheet" href="../css/bootstrap.min.css" />
	<link rel="stylesheet" href="../css/profiles.css" />

	<meta charset="utf-8" />
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<style>
		#darkBackground {
			position: fixed;
			top: 0%; 
			width: 0%; 
			z-index: 199;
			background: rgba(0, 0, 0, 0.5);
			width: 100%;
			height: 100%;
			visibility: hidden;
		}

		#contactAlert {
			background-color: white;
			top: 40%; 
			width: 30%; 
			min-width: 200px;
			height: 25%; 
			min-height:150px;
			z-index: 200; 
			position: relative; 
			margin-right: auto;
			margin-left: auto; 
			visibility: hidden;
			text-align: center;
		}

		#alertButton {
			position: absolute;
			bottom: 5px;
		}
	</style>

	<script>
		//form
		function formSubmit(fname, lname, email, year, month, day, username, password)
		{
			
			var alertMessage = document.getElementById("alertMessage");
			var contactAlert = document.getElementById("contactAlert");
			var darkBackground = document.getElementById("darkBackground");
			
			if (fname == "" || lname == "" || email == "" || birthday == "" || username == "" || password == "")
			{
				alertMessage.innerHTML = "Please fill out all fields";
				contactAlert.style.visibility = "visible";
				darkBackground.style.visibility = "visible";
				return;
			}
			if (!checkEmail(email))
			{
				alertMessage.innerHTML = "Your email is invalid";
				contactAlert.style.visibility = "visible";
				darkBackground.style.visibility = "visible";
				return;
			}
			
			var success = 0;
			var xmlhttp;
			if (window.XMLHttpRequest)
			{
				xmlhttp = new XMLHttpRequest();
			}
			else
			{
				xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
			
			xmlhttp.onreadystatechange=function()
			{
				if(xmlhttp.readyState==0)
				{
					console.log("not initialized");
				}
				if(xmlhttp.readyState==1)
				{
					console.log("connection established");
				}
				
				if(xmlhttp.readyState==2)
				{
					console.log("request received");
				}
				
				if(xmlhttp.readyState==3)
				{
					console.log("processing request");
				}
				if(xmlhttp.readyState==4)
				{
					success = xmlhttp.responseText;
					if(success == 1)
					{
						window.location.href = "../profiles";
					}
					else if(success == 0)
					{
						alertMessage.innerHTML = "Something went wrong while creating your profile. Please try again later.";
						contactAlert.style.visibility = "visible";
						darkBackground.style.visibility = "visible";
					}
					else if(success == 2){
						alertMessage.innerHTML = "Username already exists. Please choose another one.";
						contactAlert.style.visibility = "visible";
						darkBackground.style.visibility = "visible";
					}
					else
					{

					}
				}
				
			}
			var birthday = year + "-" + month + "-" + day;
			xmlhttp.open("POST", "add.php", true);
			xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			xmlhttp.send("fname="+fname+"&lname="+lname+"&email="+email+"&birthday="+birthday+"&username="+username+"&password="+password);
		}

		function checkEmail(email)
		{
			if(email.match(/^\S+@\S+\.\S+$/))
			{
				return true;
			}
			else
			{
				return false;
			}
		}

		function checkPassword(password, passwordconfirm){
			if(password != passwordconfirm){
				alertMessage.innerHTML = "Your password must match!";
				contactAlert.style.visibility = "visible";
				darkBackground.style.visibility = "visible";
				return;
			}
		}

		function closeAlert()
		{
			alertMessage.innerHTML = "";
			contactAlert.style.visibility = "hidden";
			darkBackground.style.visibility = "hidden";
		}
	</script>
</head>
<body>
	<a href="../">Go Back</a>
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<h1>Create Profile</h1>
			</div>
		</div>
		<div class="row">
			<form name="addProfile" action="add.php" method="post">
				<table border="1">
					<tr>
						<td>Username</td>
						<td><input type="text" name="username"/>
					</tr>
					<tr>
						<td>Password</td>
						<td><input type="password" name="password"/>
					</tr>
					<tr>
						<td>Confirm Password</td>
						<td><input type="password" onBlur="checkPassword(password.value, passwordconfirm.value)" name="passwordconfirm"/>
					</tr>
					<tr>
						<td>First Name</td>
						<td><input type="text" name="firstname"/>
					</tr>
					<tr>
						<td>Last Name</td>
						<td><input type="text" name="lastname"/>
					</tr>
					<tr>
						<td>Email</td>
						<td><input type="text" name="email"/>
					</tr>
					<tr>
						<td>Birthday</td>
						<td>
							<select name="year">
							  	<option value="1975">1975</option>
							  	<option value="1976">1976</option>
							  	<option value="1977">1977</option>
							  	<option value="1978">1978</option>
							  	<option value="1979">1979</option>
							  	<option value="1980">1980</option>
							  	<option value="1981">1981</option>
							  	<option value="1982">1982</option>
							  	<option value="1983">1983</option>
							  	<option value="1984">1984</option>
							  	<option value="1985">1985</option>
							  	<option value="1986">1986</option>
							  	<option value="1987">1987</option>
							  	<option value="1988">1988</option>
							  	<option value="1989">1989</option>
							  	<option value="1990">1990</option>
							  	<option value="1991">1991</option>
							  	<option value="1992">1992</option>
							  	<option value="1993">1993</option>
							  	<option value="1994">1994</option>
							  	<option value="1995">1995</option>
							  	<option value="1996">1996</option>
							  	<option value="1997">1997</option>
							  	<option value="1998">1998</option>
							  	<option value="1999">1999</option>
							</select>
							<select name="month">
							  	<option value="01">January</option>
							  	<option value="02">February</option>
							  	<option value="03">March</option>
							  	<option value="04">April</option>
							  	<option value="05">May</option>
							  	<option value="06">June</option>
							  	<option value="07">July</option>
							  	<option value="08">August</option>
							  	<option value="09">September</option>
							  	<option value="10">October</option>
							  	<option value="11">November</option>
							  	<option value="12">December</option>
							</select>
							<select name="day">
							  	<option value="01">1</option>
							  	<option value="02">2</option>
							  	<option value="03">3</option>
							  	<option value="04">4</option>
							  	<option value="05">5</option>
							  	<option value="06">6</option>
							  	<option value="07">7</option>
							  	<option value="08">8</option>
							  	<option value="09">9</option>
							  	<option value="10">10</option>
							  	<option value="11">11</option>
							  	<option value="12">12</option>
							  	<option value="13">13</option>
							  	<option value="14">14</option>
							  	<option value="15">15</option>
							  	<option value="16">16</option>
							  	<option value="17">17</option>
							  	<option value="18">18</option>
							  	<option value="19">19</option>
							  	<option value="20">20</option>
							  	<option value="21">21</option>
							  	<option value="22">22</option>
							  	<option value="23">23</option>
							  	<option value="24">24</option>
							  	<option value="25">25</option>
							  	<option value="26">26</option>
							  	<option value="27">27</option>
							  	<option value="28">28</option>
							  	<option value="29">29</option>
							  	<option value="30">30</option>
							  	<option value="31">31</option>
							</select>
					</tr>
				</table>
				<input type="button" value="Create" onClick="formSubmit(firstname.value, lastname.value, email.value, year.value, month.value, day.value, username.value, password.value)" />
			</form>
		</div>
	</div>
	<div id="darkBackground">
		<div id="contactAlert">
			<p id="alertMessage"></p>
			<button id="alertButton" onClick="closeAlert()">OK</button>
		</div>
	</div>
	<a href="../profiles">View All Profiles</a>
</body>
</html>