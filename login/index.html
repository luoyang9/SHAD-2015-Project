<!DOCTYPE html>
<html lang="en">
<head>
	<title>Profiles - SHAD Project</title>
	<link rel="shortcut icon" href="../img/logo.ico">

	<link rel="stylesheet" href="../css/bootstrap.min.css" />
	<link rel="stylesheet" href="../css/profiles.css" />

	<meta charset="utf-8" />
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<style>
		#darkBackground {
			position: fixed;
			top: 0%; 
			width: 0%; 
			z-index: 199;
			background: rgba(0, 0, 0, 0.5);
			width: 100%;
			height: 100%;
			visibility: hidden;
		}

		#contactAlert {
			background-color: white;
			top: 40%; 
			width: 30%; 
			min-width: 200px;
			height: 25%; 
			min-height:150px;
			z-index: 200; 
			position: relative; 
			margin-right: auto;
			margin-left: auto; 
			visibility: hidden;
			text-align: center;
		}

		#alertButton {
			position: absolute;
			bottom: 5px;
		}

		#loginContainer {
			text-align: center;
		}
	</style>
	<script>
		function logIn(username, password){
			
			var alertMessage = document.getElementById("alertMessage");
			var contactAlert = document.getElementById("contactAlert");
			var darkBackground = document.getElementById("darkBackground");
			var feedback = document.getElementById("feedback");

			if (username == "" || password == "")
			{
				feedback.innerHTML = "Please fill out all fields";
				return;
			}
			
			var success = 0;
			var xmlhttp;
			if (window.XMLHttpRequest)
			{
				xmlhttp = new XMLHttpRequest();
			}
			else
			{
				xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
			
			xmlhttp.onreadystatechange=function()
			{
				if(xmlhttp.readyState==0)
				{
					console.log("not initialized");
				}
				if(xmlhttp.readyState==1)
				{
					console.log("connection established");
				}
				
				if(xmlhttp.readyState==2)
				{
					console.log("request received");
				}
				
				if(xmlhttp.readyState==3)
				{
					console.log("processing request");
				}
				if(xmlhttp.readyState==4)
				{
					success = xmlhttp.responseText;	
					if(success == 1)
					{
						window.location.href = "../profile";
					}
					else if(success == 2){
						feedback.innerHTML = "Incorrect username or password.";
					}
					else if(success == 0)
					{
						alertMessage.innerHTML = "Something went wrong while logging in. Please try again later.";
						contactAlert.style.visibility = "visible";
						darkBackground.style.visibility = "visible";
					}
				}
				
			}
			xmlhttp.open("POST", "login.php", true);
			xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			xmlhttp.send("username="+username+"&password="+password);
		}

		function closeAlert()
		{
			alertMessage.innerHTML = "";
			contactAlert.style.visibility = "hidden";
			darkBackground.style.visibility = "hidden";
		}
	</script>
</head>
<body>
	<nav class="navbar navbar-default" id="mainNavBar" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#mainNav">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="../"><div class="glyphicon glyphicon-cloud"></div> Ultra</a>
			</div>
		</div>
	</nav>
	<div class="container" id="loginContainer">
		<div class="row">
			<div class="col-md-12">
				<h1>Login</h1>
			</div>
		</div>
		<div class="row">
			<form name="addProfile" action="add.php" method="post">
				<table border="1" align="center">
					<tr>
						<td>Username</td>
						<td><input type="text" name="username"/>
					</tr>
					<tr>
						<td>Password</td>
						<td><input type="password" name="password"/>
					</tr>
				</table>
				<input type="button" value="Log In" onClick="logIn(username.value, password.value)" />
			</form>
			<a href="../profiles">View All Profiles</a>
			<p id="feedback" style="color:red;"></p>
		</div>
	</div>
	<div id="darkBackground">
		<div id="contactAlert">
			<p id="alertMessage"></p>
			<button id="alertButton" onClick="closeAlert()">OK</button>
		</div>
	</div>
</body>
</html>